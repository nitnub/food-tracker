@model CalendarVM

@{
    var MIN_DISPLAY_YEAR = 2021;
    var MAX_DISPLAY_YEAR = DateTime.Now.Year + 1;

    var MIN_DISPLAY_MONTH = 1;
    var MAX_DISPLAY_MONTH = 12;

    var MAX_DISPLAY_ACTIVITIES = 4;
    var MAX_DISPLAY_REACTIONS = 5;
    var format = "yyyy-MM-dd";
}
<!-- Meal Details Modal (Calendar) -->
<div id="meal-modal" class="modal meal-details-modal fade" role="dialog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Meal Details</h5>
            </div>
            <div id="meal-modal-body" class="modal-body">
                <div id="mealCard"></div>
            </div>
            @* <div class="modal-footer"></div> *@
        </div>
    </div>
</div>


<!-- Delete Confirmation Modal (Meal) -->
<div id="meal-delete-modal" class="modal delete-meal-modal fade" role="dialog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
            </div>
            <div id="meal-delete-modal-body" class="modal-body"></div>
            <div id="meal-delete-modal-footer" class="modal-footer"></div>
        </div>
    </div>
</div>

<!-- TEST Modal (Day Reactions) -->
<div id="updateModal" class="modal show meal-details-modal fade " role="dialog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
        <div class="modal-content calendar-modal">
            <ul class="nav nav-tabs" id="updateTabList" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="home" aria-selected="true">Overall Feeling</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="false">Meal</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Activities</button>
                </li>
            </ul>
            <div id="updateModalBody" class="modal-body">
            </div>
        </div>
    </div>
</div>

<partial name="_CalendarNavPartial" model="Model" />

<div class="d-flex">
    @foreach (var day in Enum.GetNames<DayOfWeek>())
    {
        <div class="card border-secondary m-1 col-6" style="width: 10rem;">
            <div class="card-body text-secondary">
                <h5 class="card-title">
                    @day
                </h5>
            </div>
        </div>
    }
</div>












@for (int i = 0; i < Model.DayVMs.GetLength(0); i++)
{
    <div class="d-flex">
        @for (int j = 0; j < Model.DayVMs.GetLength(1); j++)
        {
            var dayId = Model.DayVMs[i, j].DateTime.Date.ToString(format);
            <div class="card day-card border-secondary m-1 col-6 @(DateTime.Now.Date.Equals(Model.DayVMs[i, j].DateTime.Date) ? "active-calendar-day"  : ""  ) " style="width: 10rem;">

                <div class="card-header d-flex justify-content-end">
                    <div id="day_@dayId" class="d-flex justify-content-center align-items-center calendar-day-icon bg-@(Model.DayVMs[i, j].Color)">
                        @Model.DayVMs[i, j].Day
                    </div>
                </div>

                <div id="reactionContainer@(dayId)" class=" d-flex flex-wrap justify-content-center calendar-reaction-container h-100" onclick="dayReactionUpdate('@dayId')">
                    @{
                        var reactions = Model.DayVMs[i, j].ReactionIcons;
                    }
                 @*    @if (reactions == null)
                    {

                    } *@
@*                     else if (Model.DayVMs[i, j].UserSafeDay)
                    {
                        <div class="calendar-badge text-success">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-emoji-laughing" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                <path d="M12.331 9.5a1 1 0 0 1 0 1A5 5 0 0 1 8 13a5 5 0 0 1-4.33-2.5A1 1 0 0 1 4.535 9h6.93a1 1 0 0 1 .866.5M7 6.5c0 .828-.448 0-1 0s-1 .828-1 0S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 0-1 0s-1 .828-1 0S9.448 5 10 5s1 .672 1 1.5" />
                            </svg>
                        </div>
                    } *@
@*                     else if (reactions.Count > 0)
                    { *@
                        @if (reactions.Count <= MAX_DISPLAY_REACTIONS)
                        {
                            @foreach (var reaction in reactions)
                            {
                                <div class="calendar-badge @reaction.Color" data-toggle="tooltip" data-placement="top" title="@reaction.Name">@Html.Raw(reaction.HTML)</div>
                            }
                        }

                        else
                        {
                            @for (int k = 0; k < reactions.Count && k < MAX_DISPLAY_REACTIONS - 1; k++)
                            {
                                var reaction = reactions[k];
                                <div class="calendar-badge @reaction.Color" data-toggle="tooltip" data-placement="top" title="@reaction.Name">@Html.Raw(reaction.HTML)</div>
                            }
                            <div>
                                <div>+@(reactions.Count - MAX_DISPLAY_REACTIONS + 1)</div>
                            </div>
                        }
                    @* } *@
      @*               else
                    {
                        <div class="calendar-badge text-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="bi bi-emoji-smile" viewBox="0 0 16 16">
                                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16" />
                                <path d="M4.285 9.567a.5.5 0 0 1 .683.183A3.5 3.5 0 0 0 8 11.5a3.5 3.5 0 0 0 3.032-1.75.5.5 0 1 1 .866.5A4.5 4.5 0 0 1 8 12.5a4.5 4.5 0 0 1-3.898-2.25.5.5 0 0 1 .183-.683M7 6.5C7 7.328 6.552 8 6 8s-1-.672-1-1.5S5.448 5 6 5s1 .672 1 1.5m4 0c0 .828-.448 1.5-1 1.5s-1-.672-1-1.5S9.448 5 10 5s1 .672 1 1.5" />
                            </svg>
                        </div>
                    } *@

                </div>
                <div class="calendar-meal-container h-100"
                     onclick="activateModal(@(JsonSerializer.Serialize(Model.DayVMs[i, j])))" type="button">

                    @if (Model.DayVMs[i, j].Meals != null)
                    {
                        @foreach (var meal in Model.DayVMs[i, j].Meals)
                        {
                            <div id="meal@(meal.Id)" class="calendar-item-@(meal.Color.Name.ToString().ToLower()) my-1" onclick="activateModal(@(JsonSerializer.Serialize(Model.DayVMs[i, j])), @meal.Id)">
                                @meal.Name
                            </div>
                        }
                    }
                </div>

                <div class="card-footer day-card-footer  border-success" onclick="openDayActivityUpdate('@Model.DayVMs[i, j].DateTime')">
                    <div class="d-flex calendar-badges flex-wrap justify-content-center">
                        @{
                            var icons = Model.DayVMs[i, j].ActivityIcons
                                                                .GroupBy(icon => icon.Id)
                                                                .Select(iGrp => iGrp.First())
                                                                .ToList();
                        }

                        @if (icons.Count <= MAX_DISPLAY_ACTIVITIES)
                        {
                            @foreach (var icon in icons)
                            {
                                <div class="calendar-badge" data-toggle="tooltip" data-placement="top" title="@icon.Name">
                                    @Html.Raw(icon.HTML)
                                </div>
                            }
                        }

                        else
                        {
                            @for (int k = 0; k < icons.Count && k < MAX_DISPLAY_ACTIVITIES - 1; k++)
                            {
                                var icon = icons[k];
                                <div class="calendar-badge" data-toggle="tooltip" data-placement="top" title="@icon.Name">
                                    @Html.Raw(icon.HTML)
                                </div>
                            }
                            <div>
                                <div>+@(Model.DayVMs[i, j].ActivityIcons.Count - MAX_DISPLAY_ACTIVITIES + 1)</div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
    @{
        <script>
            var reactionIcons = @Json.Serialize(Model.ReactionIcons);
        </script>
        <script src="~/js/calendar.js"></script>
        <script src="~/js/addMeal.js"></script>
        <script src="~/js/dayReaction.js"></script>
        <script src="~/js/activity.js"></script>
    }
}